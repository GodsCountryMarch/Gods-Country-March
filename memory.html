<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memory Wall — God’s Country March</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white">

  <!-- NAV -->
  <header class="fixed top-0 inset-x-0 z-50 bg-black/80 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 py-3 flex justify-between items-center text-sm">
      <a href="index.html" class="font-bold hover:text-amber-400">God’s Country March</a>
      <nav class="space-x-4">
        <a href="mission.html">Mission</a>
        <a href="sponsors.html">Sponsors</a>
        <a href="gallery.html">Photos</a>
        <a href="blog.html">Blog</a>
        <a href="volunteer.html">Volunteer</a>
        <a href="merch.html">Merch</a>
        <a href="memory.html" class="text-amber-400">Memory Wall</a>
        <a href="https://donorbox.org/2025-gods-country-march" target="_blank">Donate</a>
      </nav>
    </div>
  </header>
  <div class="h-16"></div>

  <!-- HERO -->
  <section class="text-center py-12">
    <h1 class="text-4xl font-extrabold">Charlie Kirk Memory Wall</h1>
    <p class="mt-2 text-slate-300">Leave a message for the Kirk family. You can also include a photo.</p>
  </section>

  <!-- FORM -->
  <section class="mx-auto max-w-xl px-4">
    <form id="memoryForm" class="space-y-4 bg-white/5 p-6 rounded-xl shadow-lg">
      <input type="text" id="name" placeholder="Your Name" class="w-full px-3 py-2 rounded bg-white/10 border border-white/20" required />
      <textarea id="message" placeholder="Write your message..." class="w-full px-3 py-2 rounded bg-white/10 border border-white/20" required></textarea>
      <input type="file" id="photo" accept="image/*" class="block w-full text-sm text-slate-300" />
      <button type="submit" class="w-full rounded-xl bg-amber-400 text-slate-900 py-2 font-bold hover:shadow-lg">Post Message</button>
    </form>
  </section>

  <!-- WALL -->
  <section class="mx-auto max-w-3xl px-4 mt-10">
    <div id="wall" class="space-y-6 overflow-y-auto max-h-[600px] p-4 border border-white/10 rounded-xl bg-white/5"></div>
  </section>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAGwWozUzlpVTE4F_CKNK-eBWa7U18Kxic",
      authDomain: "godscountrymarch-c0e4c.firebaseapp.com",
      projectId: "godscountrymarch-c0e4c",
      storageBucket: "godscountrymarch-c0e4c.firebasestorage.app",
      messagingSenderId: "890204418757",
      appId: "1:890204418757:web:4e1b3dca1406df77e4f6ac",
      measurementId: "G-QGP1C4XHC0"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const form = document.getElementById("memoryForm");
    const wall = document.getElementById("wall");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const message = document.getElementById("message").value;
      const photo = document.getElementById("photo").files[0];
      let photoURL = null;

      if (photo) {
        const storageRef = ref(storage, "photos/" + Date.now() + "-" + photo.name);
        await uploadBytes(storageRef, photo);
        photoURL = await getDownloadURL(storageRef);
      }

      await addDoc(collection(db, "memories"), {
        name,
        message,
        photoURL,
        timestamp: new Date()
      });

      form.reset();
    });

    const q = query(collection(db, "memories"), orderBy("timestamp", "desc"));
    onSnapshot(q, (snapshot) => {
      wall.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        wall.innerHTML += `
          <div class="p-4 rounded-lg bg-black/40 shadow">
            <p class="font-bold">${data.name}</p>
            <p class="mt-1">${data.message}</p>
            ${data.photoURL ? `<img src="${data.photoURL}" class="mt-2 max-h-48 rounded"/>` : ""}
            <div class="mt-2 flex gap-3 text-xs text-slate-400">
              <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(data.message)}" target="_blank">Share on Twitter</a>
              <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}" target="_blank">Share on Facebook</a>
            </div>
          </div>`;
      });
    });
  </script>
</body>
</html>
